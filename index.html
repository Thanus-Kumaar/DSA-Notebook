<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>🧠 DSA Pattern Notebook</title>
    <style>
      :root {
        --bg: #f9f6f2; /* off-white with warmth */
        --fg: #2b2b2b; /* dark brown-gray text */
        --card-bg: #ffffff;
        --border: #e9d5bc; /* sandy border */
        --accent: #ab6f2a; /* warm amber accent */
      }
      body.dark {
        --bg: #201824; /* muted purple-black */
        --fg: #eae0e8; /* soft lavender-gray text */
        --card-bg: #2b2130; /* dark plum card background */
        --border: #3a2b3f; /* purple-gray border */
        --accent: #c084fc; /* soft violet accent */
      }
      body {
        margin: 0;
        font-family: "Segoe UI", Arial, sans-serif;
        display: flex;
        height: 100vh;
        background: var(--bg);
        color: var(--fg);
        transition: background 0.3s, color 0.3s;
        overflow: hidden;
      }
      #sidebar {
        width: 250px;
        min-width: 250px;
        background: var(--card-bg);
        color: var(--fg);
        overflow-y: auto;
        padding: 10px;
        border-right: 1px solid var(--border);
        transition: width 0.3s ease, padding 0.3s ease;
      }

      #sidebar.collapsed {
        width: 0;
        min-width: 0;
        padding: 0;
        border: none;
        overflow: hidden;
      }
      #sidebar h2 {
        font-size: 1.2em;
        margin-top: 0;
      }
      #sidebar ul {
        list-style: none;
        padding: 0;
      }
      #sidebar li {
        padding: 8px;
        cursor: pointer;
        border-radius: 6px;
        margin-bottom: 4px;
      }
      #sidebar li:hover {
        background: var(--border);
      }
      #main {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      #controls {
        padding: 10px;
        border-bottom: 1px solid var(--border);
        display: flex;
        gap: 10px;
        align-items: center;
        background: var(--card-bg);
      }
      select,
      button,
      input {
        padding: 6px 8px;
        border-radius: 6px;
        border: 1px solid var(--border);
        background: var(--bg);
        color: var(--fg);
      }
      button {
        cursor: pointer;
        background: var(--accent);
        color: #fff;
        border: none;
        transition: background 0.3s;
      }
      button:hover {
        background: #7a5ce8;
      }
      #themeToggle,
      #sidebarToggle {
        cursor: pointer;
        border: none;
        background: var(--accent);
        color: #fff;
        border-radius: 6px;
        padding: 6px 10px;
      }
      #content {
        flex: 1;
        display: flex;
        padding: 10px;
        gap: 10px;
        overflow: hidden;
      }
      #docs {
        flex: 1;
        overflow-y: auto;
        padding: 10px;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }
      .tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 10px;
        position: sticky;
        top: -10px;
        background: var(--bg);
        padding-bottom: 8px;
        z-index: 5;
      }
      .tabs button {
        flex: 1;
        padding: 8px;
        border: none;
        cursor: pointer;
        border-radius: 6px;
        background: var(--border);
        color: var(--fg);
      }
      .tabs button.active {
        background: var(--accent);
        color: #fff;
      }
      .card {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      }
      .card h3 {
        margin-top: 0;
      }
      #editor-container {
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      #editor {
        flex: 1;
        border: 1px solid var(--border);
        border-radius: 10px;
        overflow: hidden;
      }
      #output {
        height: 150px;
        overflow-y: auto;
        border: 1px solid var(--border);
        padding: 10px;
        margin-top: 8px;
        background: var(--card-bg);
        border-radius: 10px;
        white-space: pre-wrap;
        word-break: break-word;
      }
      #modeInfo {
        margin-left: 6px;
        cursor: pointer;
        font-size: 0.9em;
        display: inline-block;
        color: var(--accent);
        position: relative;
      }

      #docsView {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      #modeInfo:hover::after {
        content: attr(data-info);
        position: absolute;
        top: 120%;
        left: 0;
        background: var(--card-bg);
        color: var(--fg);
        padding: 6px 10px;
        border: 1px solid var(--border);
        border-radius: 6px;
        white-space: pre-line;
        width: 200px;
        font-size: 0.85em;
        z-index: 10;
      }
      .hidden {
        display: none;
      }
    </style>
    <!-- Markdown renderer -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- CodeMirror -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/dracula.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
      // Enable auto-highlighting on load
      document.addEventListener("DOMContentLoaded", () => {
        hljs.highlightAll();
      });
    </script>
  </head>
  <body>
    <div id="sidebar">
      <h2>📚 Patterns</h2>
      <ul id="topics"></ul>
    </div>
    <div id="main">
      <div id="controls">
        <button id="sidebarToggle">📂</button>
        <label>
          <span id="modeInfo">ⓘ</span>
          Mode:
        </label>
        <select id="mode">
          <option value="practice">Practice Mode</option>
          <option value="cross">Cross-links Mode</option>
          <option value="edge">Edge Case Mode</option>
        </select>
        <input type="password" id="apiKey" placeholder="Gemini API Key" />
        <button onclick="generateAI()">✨ Generate</button>
        <label>Lang:</label>
        <select id="language" onchange="setLanguage(this.value)">
          <option value="cpp">C++</option>
          <option value="python">Python</option>
          <option value="java">Java</option>
        </select>
        <button id="themeToggle">🌙 Theme</button>
      </div>
      <div id="content">
        <div id="docs">
          <div class="tabs">
            <button id="docsTab" class="active">📄 Docs</button>
            <button id="aiTab">🤖 AI Response</button>
          </div>
          <div id="docsView">
            <div id="placeholder" class="card">
              <h3>Welcome 👋</h3>
              <p>
                Please select a topic from the sidebar to view its
                <b>summary</b> and <b>pattern</b>.
              </p>
            </div>
            <div class="card">
              <h3>Summary</h3>
              <div id="summary">
                Summary of selected topic will be displayed here!
              </div>
            </div>
            <div class="card">
              <h3>Pattern</h3>
              <div id="pattern">
                Common patterns present in the selected topic will be shown here!
              </div>
            </div>
          </div>
          <div id="aiView" style="display: none">
            <div class="card">
              <h3>AI Response</h3>
              <div id="aiOutput">No response yet.</div>
            </div>
          </div>
        </div>
        <div id="editor-container">
          <textarea id="editor"></textarea>
          <div id="output"></div>
        </div>
      </div>
    </div>

    <script>
      // hidden system prompts
      const prompts = {
        practice: `You are a DSA coding tutor.
From the given pattern.md content, identify the **Common Variations** section (or equivalent).
For each variation listed, generate a **C++ implementation** as a standalone function or small program.

Rules:
- Respond in **Markdown format**.
- Start with a top-level heading using the pattern’s name.
- For each variation, create a "## Heading" with the variation name.
- Under each heading, include a short one-line description (max 1 sentence).
- Then provide the **C++ code snippet** inside a fenced code block (\`\`\`cpp).
- Do NOT add extra explanation, just the heading + snippet.
- Cover all variations mentioned in the context.

Focus: The response should be a compact "practice notebook" of code snippets.`,

        cross: `You are a DSA mentor.
Compare this pattern against at least 2 other related patterns (from the context or your knowledge).
Highlight differences, when to prefer each, and provide one **C++ example snippet** per comparison.
Respond in Markdown.`,

        edge: `You are a problem setter.
Using the given pattern.md context, generate **edge-case C++ practice snippets**.
For each edge case (like empty input, k=1, all elements same, etc.), write a short description and a \`\`\`cpp code block showing how to handle it.
Respond in Markdown.`,
      };

      // Tab toggles
      const docsTab = document.getElementById("docsTab");
      const aiTab = document.getElementById("aiTab");
      const docsView = document.getElementById("docsView");
      const aiView = document.getElementById("aiView");
      const aiOutput = document.getElementById("aiOutput");

      docsTab.onclick = () => {
        docsTab.classList.add("active");
        aiTab.classList.remove("active");
        docsView.style.display = "block";
        aiView.style.display = "none";
      };
      aiTab.onclick = () => {
        aiTab.classList.add("active");
        docsTab.classList.remove("active");
        docsView.style.display = "none";
        aiView.style.display = "block";
      };

      const modeInfoMap = {
        practice:
          "Practice Mode:\nGenerates 3–5 full code snippets of this pattern.",
        cross: "Cross-links Mode:\nCompares this pattern with related ones.",
        edge: "Edge Case Mode:\nGenerates tricky/variant snippets.",
      };

      const modeSelect = document.getElementById("mode");
      const modeInfo = document.getElementById("modeInfo");

      // set initial info
      modeInfo.setAttribute("data-info", modeInfoMap[modeSelect.value]);

      modeSelect.addEventListener("change", () => {
        modeInfo.setAttribute("data-info", modeInfoMap[modeSelect.value]);
      });

      const folders = [
        "01-hashing",
        "02-two-pointers",
        "03-linked-list",
        "04-sliding-window",
        "05-trees",
        "06-bfs",
        "07-backtracking",
        "08-dynamic-programming",
        "09-binary-search",
        "10-heaps-priority-queues",
        "11-grid-traversal",
        "12-graphs",
        "13-greedy-algorithms",
        "14-monotonic-stack",
        "15-prefix-sum",
        "16-algorithmic-insights",
        "17-interval-problems",
        "18-tries",
        "19-dsu",
        "20-bitmasking",
      ];

      const topicsEl = document.getElementById("topics");
      folders.forEach((f) => {
        const li = document.createElement("li");
        li.textContent = f;
        li.onclick = () => loadDocs(f);
        topicsEl.appendChild(li);
      });

      let currentFolder = null;
      async function loadDocs(folder) {
        currentFolder = folder;
        document.getElementById("placeholder").classList.add("hidden");
        document.getElementById("summary").classList.remove("hidden");
        document.getElementById("pattern").classList.remove("hidden");

        const summary = await fetch(`${folder}/summary.md`)
          .then((r) => r.text())
          .catch(() => "# Missing summary.md");
        const pattern = await fetch(`${folder}/pattern.md`)
          .then((r) => r.text())
          .catch(() => "# Missing pattern.md");

        document.getElementById("summary").innerHTML = marked.parse(summary);
        document.getElementById("pattern").innerHTML = marked.parse(pattern);
      }

      // CodeMirror setup
      let cm = CodeMirror.fromTextArea(document.getElementById("editor"), {
        mode: "text/x-c++src",
        lineNumbers: true,
        theme: "default",
      });

      // Boilerplates
      const boilerplates = {
        cpp: `#include <bits/stdc++.h>
using namespace std;
int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);

    // Your code here

    return 0;
}`,
        python: `def main():
    # Your code here
    pass

if __name__ == "__main__":
    main()`,
        java: `import java.util.*;
public class Main {
    public static void main(String[] args) {
        // Your code here
    }
}`,
      };

      function setLanguage(lang) {
        if (lang === "cpp") cm.setOption("mode", "text/x-c++src");
        if (lang === "python") cm.setOption("mode", "python");
        if (lang === "java") cm.setOption("mode", "text/x-java");
        cm.setValue(boilerplates[lang]);
      }

      async function generateAI() {
        if (!currentFolder) return alert("Select a folder first.");
        const apiKey = document.getElementById("apiKey").value.trim();
        if (!apiKey) return alert("Enter your Gemini API key.");

        const mode = document.getElementById("mode").value;
        const summary = await fetch(`${currentFolder}/summary.md`)
          .then((r) => r.text())
          .catch(() => "");
        const pattern = await fetch(`${currentFolder}/pattern.md`)
          .then((r) => r.text())
          .catch(() => "");
        const context = summary + "\n\n" + pattern;
        const systemPrompt = prompts[mode];
        const userPrompt = `${systemPrompt}\n\nPattern context:\n${context}`;

        // Show loader + switch to AI tab
        aiOutput.innerHTML = "<em>⏳ Generating response...</em>";
        hljs.highlightAll();
        docsTab.classList.remove("active");
        aiTab.classList.add("active");
        docsView.style.display = "none";
        aiView.style.display = "block";

        const resp = await fetch(
          "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-goog-api-key": apiKey,
            },
            body: JSON.stringify({
              contents: [{ parts: [{ text: userPrompt }] }],
            }),
          }
        ).then((r) => r.json());

        const text =
          resp.candidates?.[0]?.content?.parts?.[0]?.text || "⚠️ No response.";
        aiOutput.innerHTML = marked.parse(text);
        hljs.highlightAll();
      }

      // Theme toggle
      document.getElementById("themeToggle").onclick = () => {
        document.body.classList.toggle("dark");
        cm.setOption(
          "theme",
          document.body.classList.contains("dark") ? "dracula" : "default"
        );
      };

      // Sidebar toggle
      document.getElementById("sidebarToggle").onclick = () => {
        document.getElementById("sidebar").classList.toggle("collapsed");
      };
    </script>
  </body>
</html>
