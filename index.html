<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>🧠 DSA Pattern Notebook</title>
    <style>
      :root {
        --bg: #f9f6f2; /* off-white with warmth */
        --fg: #2b2b2b; /* dark brown-gray text */
        --card-bg: #ffffff;
        --border: #e9d5bc; /* sandy border */
        --accent: #ab6f2a; /* warm amber accent */
      }
      body.dark {
        --bg: #201824; /* muted purple-black */
        --fg: #eae0e8; /* soft lavender-gray text */
        --card-bg: #2b2130; /* dark plum card background */
        --border: #3a2b3f; /* purple-gray border */
        --accent: #c084fc; /* soft violet accent */
      }
      body {
        margin: 0;
        font-family: "Segoe UI", Arial, sans-serif;
        display: flex;
        height: 100vh;
        background: var(--bg);
        color: var(--fg);
        transition: background 0.3s, color 0.3s;
        overflow: hidden;
      }
      #sidebar {
        width: 250px;
        min-width: 250px;
        background: var(--card-bg);
        color: var(--fg);
        overflow-y: auto;
        padding: 10px;
        border-right: 1px solid var(--border);
        transition: width 0.3s ease, padding 0.3s ease;
      }

      #sidebar.collapsed {
        width: 0;
        min-width: 0;
        padding: 0;
        border: none;
        overflow: hidden;
      }
      #sidebar h2 {
        font-size: 1.2em;
        margin-top: 0;
      }
      #sidebar ul {
        list-style: none;
        padding: 0;
      }
      #sidebar li {
        padding: 8px;
        cursor: pointer;
        border-radius: 6px;
        margin-bottom: 4px;
      }
      #sidebar li:hover {
        background: var(--border);
      }
      #main {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      #controls {
        padding: 10px 16px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--card-bg);
        gap: 12px;
      }
      .control-group {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      #controls label {
        font-weight: 500;
        margin-right: 4px;
        color: var(--fg);
      }
      #controls select,
      #controls input {
        padding: 6px 10px;
        border-radius: 6px;
        border: 1px solid var(--border);
        background: var(--bg);
        color: var(--fg);
        font-size: 0.9em;
      }
      #controls button {
        cursor: pointer;
        background: var(--accent);
        color: #fff;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        font-size: 0.9em;
        font-weight: 500;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
      }
      #controls button:hover {
        background: #7a5ce8;
      }
      #themeToggle,
      #sidebarToggle {
        cursor: pointer;
        border: none;
        background: var(--accent);
        color: #fff;
        border-radius: 6px;
        padding: 6px 10px;
      }
      #selectedFolder {
        font-weight: bold;
        font-size: larger;
        margin: 0 10px;
        color: var(--accent);
      }
      #placeholder {
        padding: 15px;
      }
      #content {
        flex: 1;
        display: flex;
        padding: 10px;
        gap: 10px;
        overflow: hidden;
      }
      #docs {
        flex: 1;
        overflow-y: auto;
        padding: 10px;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }
      .tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 10px;
        position: sticky;
        top: -10px;
        background: var(--bg);
        padding-bottom: 8px;
        z-index: 5;
      }
      .tabs button {
        flex: 1;
        padding: 8px;
        border: none;
        cursor: pointer;
        border-radius: 6px;
        background: var(--border);
        color: var(--fg);
      }
      .tabs button.active {
        background: var(--accent);
        color: #fff;
      }
      .card {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 10px;
        padding: 0px 15px 0px 15px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
      }
      .card h3 {
        margin-top: 0;
      }
      #editor-container {
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      .CodeMirror {
        flex: 1; /* take all available space */
        height: 100% !important; /* force full height */
        border: 1px solid var(--border);
        border-radius: 10px;
        font-size: 14px; /* tweak for readability */
      }
      #editor {
        flex: 1;
        border: 1px solid var(--border);
        border-radius: 10px;
        overflow: hidden;
        height: 100%;
      }
      #modeInfo {
        margin-left: 6px;
        cursor: pointer;
        font-size: 0.9em;
        display: inline-block;
        color: var(--accent);
        position: relative;
      }

      #docsView {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      #modeInfo:hover::after {
        content: attr(data-info);
        position: absolute;
        top: 120%;
        left: 0;
        background: var(--card-bg);
        color: var(--fg);
        padding: 6px 10px;
        border: 1px solid var(--border);
        border-radius: 6px;
        white-space: pre-line;
        width: 200px;
        font-size: 0.85em;
        z-index: 10;
      }
      .hidden {
        display: none;
      }
    </style>
    <!-- Markdown renderer -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- CodeMirror -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/dracula.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/solarized.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/closebrackets.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/hint/show-hint.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/hint/show-hint.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
      // Enable auto-highlighting on load
      document.addEventListener("DOMContentLoaded", () => {
        hljs.highlightAll();
      });
    </script>
  </head>
  <body>
    <div id="sidebar">
      <h2>📚 Patterns</h2>
      <ul id="topics"></ul>
    </div>
    <div id="main">
      <div id="controls">
        <div id="control-group">
          <button id="sidebarToggle">📂</button>
          <span id="selectedFolder">No folder selected</span>
        </div>

        <div class="control-group">
          <label>
            Mode:
            <span id="modeInfo">ⓘ</span>
            <select id="mode">
              <option value="practice">Practice Mode</option>
              <option value="cross">Cross-links Mode</option>
              <option value="edge">Edge Case Mode</option>
              <option value="originEvolution">Origin & Evolution Mode</option>
              <option value="essence">Essence Mode</option>
            </select>
          </label>
          <input type="password" id="apiKey" placeholder="Gemini API Key" />
          <button onclick="generateAI()">✨ Generate</button>
        </div>

        <div class="control-group">
          <label>Lang:</label>
          <select id="language" onchange="setLanguage(this.value)">
            <option value="nil">Select Language</option>
            <option value="cpp">C++</option>
            <option value="python">Python</option>
            <option value="java">Java</option>
          </select>
          <button id="themeToggle">🌙 Theme</button>
        </div>
      </div>

      <div id="content">
        <div id="docs">
          <div class="tabs">
            <button id="docsTab" class="active">📄 Docs</button>
            <button id="aiTab">🤖 AI Response</button>
          </div>
          <div id="docsView">
            <div id="placeholder" class="card">
              <h3>Welcome 👋</h3>
              <p>
                Please select a topic from the sidebar to view its
                <b>summary</b> and <b>pattern</b>.
              </p>
            </div>
            <div class="card">
              <div id="summary">
                <div style="padding: 15px">
                  Summary of selected topic will be displayed here!
                </div>
              </div>
            </div>
            <div class="card">
              <div id="pattern">
                <div style="padding: 15px">
                  Common patterns present in the selected topic will be shown
                  here!
                </div>
              </div>
            </div>
          </div>
          <div id="aiView" style="display: none">
            <div class="card">
              <h2>AI Response</h2>
              <div id="aiOutput">
                <div style="padding-bottom: 20px">No response yet.</div>
              </div>
            </div>
          </div>
        </div>
        <div id="editor-container">
          <textarea id="editor"></textarea>
        </div>
      </div>
    </div>

    <script>
      // hidden system prompts
      const prompts = {
        practice: (lang) => `You are a DSA coding tutor.
Your job is to generate a **Practice Notebook** for the learner.

Input: A markdown file describing the DSA pattern (with summary + common variations).
Task:
1. Identify the **Common Variations** section (or equivalent).
2. For each variation, create a Markdown section.

Format:
# {Pattern Name}
## {Variation Name}
- *One-line description (max 15 words).*
\`\`\`${lang}
// code implementation
\`\`\`

Rules:
- Only include the variations explicitly listed in the context.
- Keep explanations short; focus on code.
- All snippets should be standalone functions or small runnable programs.`,

        cross: (lang) => `You are a DSA mentor.
Your task is to create a **Comparative Guide**.

Input: A markdown file describing a DSA pattern.
Task:
1. Compare this pattern with **at least 2 other related patterns**.
2. Highlight:
   - Key difference
   - When to prefer each
3. Provide **one ${lang} snippet** per comparison.

Format:
# {Pattern Name} vs Other Patterns
## {Pattern A vs Pattern B}
- Differences:
  - ...
- Prefer {X} when ...
\`\`\`${lang}
// snippet
\`\`\`

Keep output compact, in Markdown format.`,

        edge: (lang) => `You are a problem setter.
Your job is to create **Edge Case Practice Snippets**.

Input: A markdown file describing the DSA pattern.
Task:
1. Identify 3–5 edge cases that learners often miss.
2. For each case, provide:
   - Short description
   - ${lang} snippet that handles that case

Format:
# {Pattern Name} Edge Cases
## Edge Case: {description}
\`\`\`${lang}
// snippet
\`\`\`

Be concise but clear. Focus on tricky inputs, boundary conditions, or unusual constraints.`,

        originEvolution:
          () => `You are a computer science historian and educator.  
Your job is to explain the **Origin & Evolution** of this DSA pattern in detail.  

Input: A markdown file describing the DSA pattern.  

Task:  
1. **Identify the Necessity**  
   - What real-world or computational problem forced people to create this pattern/algorithm/data structure?  
   - Why were existing solutions insufficient or inefficient?  
   - (Think: necessity is the mother of invention.)  

2. **Describe the Origin**  
   - Who introduced it (if known) and in what era or context?  
   - What field or problem domain first demanded it (mathematics, networking, text processing, hardware, etc.)?  
   - What were the earliest use cases?  

3. **Explain the Evolution**  
   - Which simpler approaches came before it, and what were their limitations?  
   - How this pattern improved upon them (efficiency, clarity, scalability, etc.)  
   - Which later algorithms or patterns were inspired by it or extended it?  

4. **Optional: Real-World Parallel**  
   - Mention one example outside pure CS where a similar need existed (if meaningful).  

Format:  
# Origin & Evolution of {Pattern Name}  
## Necessity (The Problem that Needed Solving)  
- ...  

## Origin (How it was Born)  
- ...  

## Evolution (How it Changed & Inspired Others)  
- ...  

## Real-World Analogy (Optional)  
- ...  

Rules:  
- Do NOT be vague. Give concrete motivation + necessity.  
- Keep it structured in Markdown, but use 3–6 detailed bullet points per section.  
- Always highlight the "necessity" first, then build the story.`,

        essence:
          () => `You are an educator explaining the distilled **Essence** of a DSA pattern.  

Input: A markdown file describing the DSA pattern.  

Task:  
1. **Core Mental Model**  
   - Summarize the intuition in 1–2 sentences or a metaphor.  
   - If someone remembers only this, they should recall the pattern.  

2. **Recognition Triggers**  
   - Give 3–5 tell-tale signs in a problem statement that hint this pattern should be applied.  
   - Be very concrete (phrases, constraints, problem flavors).  

3. **Why It Works (First Principles)**  
   - Explain from scratch why this approach makes sense.  
   - Use simple logic, analogies, or ASCII sketches if helpful.  
   - Show the inevitability of the pattern (why other approaches fail).  

4. **Minimal Working Example**  
   - Provide the smallest possible code snippet that demonstrates the essence.  
   - Prefer clarity > completeness.  

Format strictly in Markdown:  

# Essence of {Pattern Name}  
## Core Mental Model  
- ...  

## Recognition Triggers  
- ...  

## Why It Works (First Principles)  
- ...  

## Minimal Example  
\`\`\`language  
(code here)  
\`\`\``,
      };

      // Tab toggles
      const docsTab = document.getElementById("docsTab");
      const aiTab = document.getElementById("aiTab");
      const docsView = document.getElementById("docsView");
      const aiView = document.getElementById("aiView");
      const aiOutput = document.getElementById("aiOutput");

      docsTab.onclick = () => {
        docsTab.classList.add("active");
        aiTab.classList.remove("active");
        docsView.style.display = "block";
        aiView.style.display = "none";
      };
      aiTab.onclick = () => {
        aiTab.classList.add("active");
        docsTab.classList.remove("active");
        docsView.style.display = "none";
        aiView.style.display = "block";
      };

      const modeInfoMap = {
        practice:
          "Practice Mode:\nGenerates 3–5 code snippets for each variation of the pattern.",
        cross:
          "Cross-links Mode:\nCompares this pattern with related ones and shows differences + examples.",
        edge: "Edge Case Mode:\nGenerates tricky boundary/variant cases with code snippets.",
        originEvolution:
          "Origin & Evolution Mode:\nExplains the historical motivation, predecessors, and successors of this pattern.",
        essence:
          "Essence Mode:\nCaptures the core mental model, key recognition triggers, and first-principles reasoning of the pattern.",
      };

      const modeSelect = document.getElementById("mode");
      const modeInfo = document.getElementById("modeInfo");

      // set initial info
      modeInfo.setAttribute("data-info", modeInfoMap[modeSelect.value]);

      modeSelect.addEventListener("change", () => {
        modeInfo.setAttribute("data-info", modeInfoMap[modeSelect.value]);
      });

      const folders = [
        "01-hashing",
        "02-two-pointers",
        "03-linked-list",
        "04-sliding-window",
        "05-trees",
        "06-bfs",
        "07-backtracking",
        "08-dynamic-programming",
        "09-binary-search",
        "10-heaps-priority-queues",
        "11-grid-traversal",
        "12-graphs",
        "13-greedy-algorithms",
        "14-monotonic-stack",
        "15-prefix-sum",
        "16-algorithmic-insights",
        "17-interval-problems",
        "18-tries",
        "19-dsu",
        "20-bitmasking",
      ];

      const topicsEl = document.getElementById("topics");
      folders.forEach((f) => {
        const li = document.createElement("li");
        li.textContent = f;
        li.onclick = () => loadDocs(f);
        topicsEl.appendChild(li);
      });

      let currentFolder = null;
      async function loadDocs(folder) {
        document.getElementById("selectedFolder").innerText = `${folder}`;
        currentFolder = folder;
        document.getElementById("placeholder").classList.add("hidden");
        document.getElementById("summary").classList.remove("hidden");
        document.getElementById("pattern").classList.remove("hidden");

        const summary = await fetch(`${folder}/summary.md`)
          .then((r) => r.text())
          .catch(() => "# Missing summary.md");
        const pattern = await fetch(`${folder}/pattern.md`)
          .then((r) => r.text())
          .catch(() => "# Missing pattern.md");

        document.getElementById("summary").innerHTML = marked.parse(summary);
        document.getElementById("pattern").innerHTML = marked.parse(pattern);
      }

      // CodeMirror setup
      let cm = CodeMirror.fromTextArea(document.getElementById("editor"), {
        lineNumbers: true,
        lineWrapping: true,
        indentUnit: 4,
        indentWithTabs: false,
        smartIndent: true,
        matchBrackets: true,
        autoCloseBrackets: true,
        styleActiveLine: true,
        highlightSelectionMatches: {
          showToken: /\w/,
          annotateScrollbar: true,
        },
        theme: "solarized light",
        mode: "text/x-c++src",
        extraKeys: {
          Tab: function (cm) {
            if (cm.somethingSelected()) {
              cm.indentSelection("add");
            } else {
              cm.replaceSelection("    ", "end");
            }
          },
          "Ctrl-Space": "autocomplete", // basic autocomplete
          "Ctrl-D": "deleteLine", // delete line
          "Ctrl-/": "toggleComment", // comment/uncomment
          "Ctrl-F": "findPersistent", // search box
        },
      });

      // Boilerplates
      const boilerplates = {
        cpp: `#include <bits/stdc++.h>
using namespace std;
int main() {
    ios::sync_with_stdio(false);
    cin.tie(nullptr);

    // Your code here

    return 0;
}`,
        python: `def main():
    # Your code here
    pass

if __name__ == "__main__":
    main()`,
        java: `import java.util.*;
public class Main {
    public static void main(String[] args) {
        // Your code here
    }
}`,
      };

      function setLanguage(lang) {
        if (lang === "cpp") cm.setOption("mode", "text/x-c++src");
        if (lang === "python") cm.setOption("mode", "python");
        if (lang === "java") cm.setOption("mode", "text/x-java");
        cm.setValue(boilerplates[lang]);
      }

      async function generateAI() {
        if (!currentFolder) return alert("Select a folder first.");
        const apiKey = document.getElementById("apiKey").value.trim();
        if (!apiKey) return alert("Enter your Gemini API key.");

        const mode = document.getElementById("mode").value;
        const lang = document.getElementById("language").value;
        if (!lang || lang == "nil") return alert("Select a Language first");
        const summary = await fetch(`${currentFolder}/summary.md`)
          .then((r) => r.text())
          .catch(() => "");
        const pattern = await fetch(`${currentFolder}/pattern.md`)
          .then((r) => r.text())
          .catch(() => "");
        const context = summary + "\n\n" + pattern;
        const systemPrompt = prompts[mode](lang);
        const userPrompt = `${systemPrompt}\n\nPattern context:\n${context}`;

        // Show loader + switch to AI tab
        aiOutput.innerHTML = "<em>⏳ Generating response...</em>";
        hljs.highlightAll();
        docsTab.classList.remove("active");
        aiTab.classList.add("active");
        docsView.style.display = "none";
        aiView.style.display = "block";

        const resp = await fetch(
          "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "X-goog-api-key": apiKey,
            },
            body: JSON.stringify({
              contents: [{ parts: [{ text: userPrompt }] }],
            }),
          }
        ).then((r) => r.json());

        const text =
          resp.candidates?.[0]?.content?.parts?.[0]?.text || "⚠️ No response.";
        aiOutput.innerHTML = marked.parse(text);
        hljs.highlightAll();
      }

      // Theme toggle
      const themeToggle = document.getElementById("themeToggle");
      themeToggle.addEventListener("click", () => {
        document.body.classList.toggle("dark");
        cm.setOption(
          "theme",
          document.body.classList.contains("dark")
            ? "dracula"
            : "solarized light"
        );
        if (document.body.classList.contains("dark")) {
          themeToggle.textContent = "☀️ Light";
        } else {
          themeToggle.textContent = "🌙 Dark";
        }
      });

      // Sidebar toggle
      document.getElementById("sidebarToggle").onclick = () => {
        document.getElementById("sidebar").classList.toggle("collapsed");
      };
    </script>
  </body>
</html>
